# üéØ GUIDE RAPIDE - Passer √† la Phase 2

**Status Phase 1:** ‚úÖ TERMIN√âE  
**Status Phase 2:** üìù PR√äTE √Ä D√âMARRER

---

## ‚úÖ Ce Qui Fonctionne Maintenant

```
INSCRIPTION ‚Üí AUTO-LOGIN ‚Üí MEMBER PORTAL ‚Üí DASHBOARD
    ‚Üì             ‚Üì              ‚Üì              ‚Üì
  Form        Connect√©       4 Cards       Profil complet
``` 

### tst Rapide (5 minutes)
1. Aller sur `/member-registration`
2. Remplir formulaire + choisir mot de passe
3. Cliquer "Register"
4. ‚úÖ **Redirection automatique vers `/member-portal`**
5. ‚úÖ Voir message "Welcome, [Nom]!"
6. ‚úÖ Voir 4 cartes color√©es
7. Cliquer "My Dashboard" (carte violette)
8. ‚úÖ Voir profil complet

---

## üöÄ D√©marrer Phase 2 - √âtapes Simples

### √âTAPE 1: Ajouter colonne expiry_date (5 min)

**Dans phpMyAdmin ou terminal MySQL:**

```sql
USE wordpress_db; -- Remplacer par votre nom de DB

ALTER TABLE wp_jgk_members 
ADD COLUMN IF NOT EXISTS expiry_date DATE NULL AFTER registration_date,
ADD INDEX idx_expiry (expiry_date);
```

**V√©rifier:**
```sql
DESCRIBE wp_jgk_members;
-- Doit voir colonne expiry_date de type DATE
```

---

### √âTAPE 2: Tester Alerte d'Expiration (3 min)

**Simuler membership expirant bient√¥t:**
```sql
UPDATE wp_jgk_members 
SET expiry_date = DATE_ADD(NOW(), INTERVAL 30 DAY)
WHERE id = 1; -- Remplacer par votre member ID
```

**V√©rifier:**
- Aller sur `/member-portal`
- ‚úÖ Doit voir alerte **JAUNE** en haut
- ‚úÖ Message: "Membership expires in 30 days"

**Simuler membership expir√©:**
```sql
UPDATE wp_jgk_members 
SET expiry_date = DATE_SUB(NOW(), INTERVAL 10 DAY)
WHERE id = 1;
```

**V√©rifier:**
- Rafra√Æchir `/member-portal`
- ‚úÖ Doit voir alerte **ROUGE** en haut
- ‚úÖ Message: "Membership Expired - Renew Now!"

**Remettre √† normal (1 an):**
```sql
UPDATE wp_jgk_members 
SET expiry_date = DATE_ADD(NOW(), INTERVAL 365 DAY)
WHERE id = 1;
```

---

### √âTAPE 3: Cr√©er Tables Comp√©titions (10 min)

**Copiez-collez dans phpMyAdmin:**

```sql
-- Table: Comp√©titions
CREATE TABLE IF NOT EXISTS wp_jgk_competitions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    date DATE NOT NULL,
    location VARCHAR(255),
    category VARCHAR(100),
    status VARCHAR(50) DEFAULT 'upcoming',
    max_participants INT,
    entry_fee DECIMAL(10,2) DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_date (date),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Table: Inscriptions
CREATE TABLE IF NOT EXISTS wp_jgk_competition_registrations (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    competition_id BIGINT UNSIGNED NOT NULL,
    member_id BIGINT UNSIGNED NOT NULL,
    status VARCHAR(50) DEFAULT 'pending',
    registration_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    payment_status VARCHAR(50) DEFAULT 'pending',
    UNIQUE KEY unique_registration (competition_id, member_id),
    FOREIGN KEY (competition_id) REFERENCES wp_jgk_competitions(id) ON DELETE CASCADE,
    FOREIGN KEY (member_id) REFERENCES wp_jgk_members(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Table: R√©sultats
CREATE TABLE IF NOT EXISTS wp_jgk_competition_results (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    competition_id BIGINT UNSIGNED NOT NULL,
    member_id BIGINT UNSIGNED NOT NULL,
    position INT,
    score INT,
    handicap_used DECIMAL(4,1),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_result (competition_id, member_id),
    FOREIGN KEY (competition_id) REFERENCES wp_jgk_competitions(id) ON DELETE CASCADE,
    FOREIGN KEY (member_id) REFERENCES wp_jgk_members(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Table: Troph√©es
CREATE TABLE IF NOT EXISTS wp_jgk_trophies (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    member_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(255) NOT NULL,
    type VARCHAR(50) NOT NULL,
    date_awarded DATE NOT NULL,
    competition_id BIGINT UNSIGNED,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (member_id) REFERENCES wp_jgk_members(id) ON DELETE CASCADE,
    FOREIGN KEY (competition_id) REFERENCES wp_jgk_competitions(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Table: Paiements
CREATE TABLE IF NOT EXISTS wp_jgk_payments (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    member_id BIGINT UNSIGNED NOT NULL,
    payment_type VARCHAR(50) NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    currency VARCHAR(3) DEFAULT 'KES',
    payment_method VARCHAR(50),
    payment_reference VARCHAR(100) UNIQUE,
    status VARCHAR(50) DEFAULT 'pending',
    transaction_date DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (member_id) REFERENCES wp_jgk_members(id) ON DELETE CASCADE,
    INDEX idx_status (status),
    INDEX idx_reference (payment_reference)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**V√©rifier:**
```sql
SHOW TABLES LIKE 'wp_jgk_%';
-- Doit voir 9 tables au total maintenant
```

---

### √âTAPE 4: Ajouter Donn√©es d'Exemple (5 min)

**Comp√©titions d'exemple:**
```sql
INSERT INTO wp_jgk_competitions (name, description, date, location, category, status, max_participants, entry_fee)
VALUES
('Junior Golf Kenya Championship 2025', 'Annual championship for all junior members', '2025-11-15', 'Karen Country Club', 'Championship', 'upcoming', 50, 1500.00),
('Youth Open Tournament', 'Open tournament for youth category', '2025-11-22', 'Muthaiga Golf Club', 'Open', 'upcoming', 60, 1000.00),
('Spring Classic 2025', 'Classic spring tournament', '2025-12-01', 'Windsor Golf Club', 'Classic', 'upcoming', 40, 1200.00);
```

**Troph√©es d'exemple (pour member_id = 1):**
```sql
INSERT INTO wp_jgk_trophies (member_id, name, type, date_awarded, competition_id)
VALUES
(1, 'Spring Open Champion 2024', 'gold', '2024-09-15', NULL),
(1, 'Most Improved Player 2024', 'special', '2024-08-20', NULL);
```

**V√©rifier:**
```sql
SELECT * FROM wp_jgk_competitions;
SELECT * FROM wp_jgk_trophies WHERE member_id = 1;
```

---

### √âTAPE 5: Mettre √† Jour Member Data Class (D√âJ√Ä FAIT ‚úÖ)

Le fichier `includes/class-juniorgolfkenya-member-data.php` est d√©j√† cr√©√© avec:
- ‚úÖ `get_membership_status()` - V√©rifie expiration
- ‚úÖ `get_upcoming_competitions()` - Liste comp√©titions
- ‚úÖ `get_past_competitions()` - R√©sultats pass√©s
- ‚úÖ `get_trophies()` - Troph√©es du membre
- ‚úÖ `get_performance_stats()` - Statistiques

**Modifier pour utiliser vraies donn√©es:**

Ouvrir: `includes/class-juniorgolfkenya-member-data.php`

**Fonction `get_upcoming_competitions()` ligne ~105:**
```php
// REMPLACER le sample data par:
public static function get_upcoming_competitions($member_id, $limit = 5) {
    global $wpdb;
    $competitions_table = $wpdb->prefix . 'jgk_competitions';
    
    $competitions = $wpdb->get_results($wpdb->prepare("
        SELECT * FROM {$competitions_table}
        WHERE status = 'upcoming' AND date >= CURDATE()
        ORDER BY date ASC
        LIMIT %d
    ", $limit));
    
    return $competitions;
}
```

---

## üìä Checklist Phase 2 Compl√®te

### Semaine 1-2: Comp√©titions
- [ ] ‚úÖ Tables SQL cr√©√©es
- [ ] Interface admin pour cr√©er comp√©titions
- [ ] Page frontend liste comp√©titions
- [ ] Page d√©tails comp√©tition
- [ ] Formulaire inscription membre
- [ ] Interface admin saisie r√©sultats

### Semaine 3-4: Paiements
- [ ] Configuration M-Pesa API
- [ ] Page renouvellement membership
- [ ] STK Push implementation
- [ ] Callback handler
- [ ] Auto-update expiry_date sur paiement
- [ ] Page historique paiements

### Semaine 5: Troph√©es
- [ ] Auto-attribution apr√®s comp√©tition
- [ ] Page galerie troph√©es
- [ ] Download certificats PDF
- [ ] Badges achievements

### Semaine 6: Analytics
- [ ] Graphiques Chart.js
- [ ] Page performance d√©taill√©e
- [ ] Leaderboards
- [ ] Comparaisons

---

## üí° Ordre Recommand√© de D√©veloppement

### JOUR 1: Setup Base de Donn√©es
1. ‚úÖ Ajouter colonne expiry_date
2. ‚úÖ Cr√©er 5 tables (competitions, registrations, results, trophies, payments)
3. ‚úÖ Ajouter donn√©es d'exemple
4. ‚úÖ Tester requ√™tes SQL

### JOUR 2-3: Comp√©titions Backend
1. Cr√©er `class-juniorgolfkenya-competitions.php`
2. M√©thodes CRUD (create, read, update, delete)
3. Page admin liste comp√©titions
4. Page admin cr√©er/√©diter comp√©tition

### JOUR 4-5: Comp√©titions Frontend
1. Page liste comp√©titions publique
2. Page d√©tails comp√©tition
3. Formulaire inscription
4. Shortcode `[jgk_competitions_list]`

### JOUR 6-7: Paiements M-Pesa
1. Configuration Daraja API
2. Class `class-juniorgolfkenya-mpesa.php`
3. STK Push implementation
4. Page renouvellement
5. Auto-update membership

### JOUR 8-9: Troph√©es & Achievements
1. Auto-attribution troph√©es
2. Page galerie troph√©es
3. Syst√®me badges
4. Certificats PDF

### JOUR 10: Analytics & Charts
1. Graphiques performance
2. Leaderboards
3. Comparaisons
4. Export donn√©es

---

## üéØ Prochaine Action Imm√©diate

**MAINTENANT:**
1. ‚úÖ Tester inscription ‚Üí Confirmer redirection fonctionne
2. ‚úÖ Ajouter colonne `expiry_date` dans MySQL
3. ‚úÖ Tester alerte jaune/rouge
4. ‚úÖ Cr√©er 5 tables SQL
5. ‚úÖ Ajouter donn√©es d'exemple

**ENSUITE (Semaine prochaine):**
1. Cr√©er interface admin comp√©titions
2. Cr√©er page frontend comp√©titions
3. Impl√©menter inscriptions
4. Commencer M-Pesa

---

## üìû Aide Rapide

**Probl√®me redirection:**
```php
// Tester dans registration form apr√®s ligne 215
error_log('Redirect URL: ' . $redirect_url);
```

**Probl√®me tables:**
```sql
-- V√©rifier foreign keys
SHOW CREATE TABLE wp_jgk_competition_registrations;
```

**Probl√®me donn√©es:**
```php
// Tester dans member portal
$comps = JuniorGolfKenya_Member_Data::get_upcoming_competitions(1);
var_dump($comps);
```

---

**üéâ VOUS √äTES PR√äT POUR PHASE 2 !**

**Temps estim√©:** 2-3 semaines pour Phase 2 compl√®te  
**Prochaine session:** Configuration M-Pesa + Interface Comp√©titions

**BONNE CHANCE ! üöÄ**
