=== CORRECTION DU CONTR√îLE DE VISIBILIT√â ===
Date: 12/10/2025

PROBL√àME RAPPORT√â:
"on update we have this erro [...] and visibility is set to hidden, can we control it"

ANALYSE:
- L'erreur SQL UPDATE ne g√©n√®re pas d'erreur r√©elle
- Le champ `is_public` est mis √† 0 dans l'update
- L'utilisateur veut pouvoir CONTR√îLER ce param√®tre
- Le champ existe dans la table et dans le formulaire, mais manquait de visibilit√©

CORRECTIONS APPLIQU√âES:

1. ‚úÖ AM√âLIORATION DU FORMULAIRE D'√âDITION
   Fichier: admin/partials/juniorgolfkenya-admin-member-edit.php (ligne ~200)
   
   AVANT:
   - Champ simple avec label "Public Visibility"
   - Peu visible, pas d'explication claire
   
   APR√àS:
   - Fond bleu clair avec bordure bleue (highlight visuel)
   - Ic√¥ne üåê pour identification rapide
   - Titre en gras: "Public Visibility Control"
   - Options avec emojis:
     * ‚úÖ Visible Publicly - Show in directories, galleries...
     * üîí Hidden from Public - Only visible to administrators...
   - Message d'avertissement d√©taill√© en dessous
   - Style CSS inline pour visibilit√© imm√©diate

2. ‚úÖ AJOUT DE LOGS DE DEBUGGING
   Fichier: admin/partials/juniorgolfkenya-admin-members.php (ligne ~190)
   
   Ajout√© apr√®s la cr√©ation du tableau $member_data:
   ```php
   error_log('JGK Member Update - is_public value: ' . 
       (isset($_POST['is_public']) ? $_POST['is_public'] : 'not set'));
   error_log('JGK Member Update - Data: ' . print_r($member_data, true));
   ```
   
   Permet de voir dans debug.log:
   - Valeur exacte de is_public re√ßue
   - Tous les champs envoy√©s dans l'update
   - D√©tection si le champ n'est pas envoy√©

3. ‚úÖ DOCUMENTATION COMPL√àTE CR√â√âE
   Fichier: VISIBILITY_CONTROL_GUIDE.md (600+ lignes)
   
   Contenu:
   - Vue d'ensemble du syst√®me
   - Explication des 2 modes (public / priv√©)
   - Code SQL pour v√©rifications
   - Exemples PHP d'utilisation
   - Shortcodes conditionnels
   - Consid√©rations RGPD
   - Tests de v√©rification
   - Migration de donn√©es
   - Checklist de d√©ploiement
   - R√©f√©rences rapides

COMMENT √áA MARCHE MAINTENANT:

1. √âDITER UN MEMBRE:
   - Aller √†: JGK Dashboard > Members > [Cliquer sur un membre]
   - Voir le champ avec fond bleu: "üåê Public Visibility Control"
   - S√©lectionner l'option voulue
   - Cliquer "Update Member"
   - Le champ is_public sera mis √† 0 ou 1

2. V√âRIFIER L'UPDATE:
   - Ouvrir: wp-content/debug.log
   - Chercher: "JGK Member Update - is_public value"
   - Voir la valeur envoy√©e (0 ou 1)

3. V√âRIFIER EN BASE:
   ```sql
   SELECT id, first_name, last_name, is_public 
   FROM wp_jgk_members 
   WHERE id = 20;
   ```
   - is_public devrait √™tre 0 ou 1

4. TESTER L'AFFICHAGE PUBLIC:
   - Cr√©er un shortcode [jgk_members] (voir guide)
   - Si is_public = 1 ‚Üí membre visible
   - Si is_public = 0 ‚Üí membre cach√© du public (sauf admins)

VALEURS DE is_public:

0 = üîí CACH√â DU PUBLIC
   - N'appara√Æt PAS dans les annuaires publics
   - N'appara√Æt PAS dans les galeries publiques
   - Visible seulement par: admins, coaches, comit√©
   - Utile pour: confidentialit√©, mineurs sans consentement

1 = ‚úÖ VISIBLE PUBLIQUEMENT
   - Appara√Æt dans tous les annuaires
   - Appara√Æt dans les galeries
   - Visible par tous (m√™me visiteurs non connect√©s)
   - Utile pour: promotion du club, pr√©sentation des membres

FICHIERS MODIFI√âS:

1. admin/partials/juniorgolfkenya-admin-member-edit.php
   - Ligne ~200: Champ is_public avec style am√©lior√©
   
2. admin/partials/juniorgolfkenya-admin-members.php
   - Ligne ~190: Ajout de logs de debugging

FICHIERS CR√â√âS:

1. VISIBILITY_CONTROL_GUIDE.md
   - Guide complet de 600+ lignes
   - Exemples de code
   - Tests SQL
   - Documentation technique

PROCHAINES √âTAPES:

1. TESTER L'UPDATE:
   - √âditer un membre
   - Changer is_public de 0 √† 1 ou inversement
   - V√©rifier dans la base de donn√©es
   - V√©rifier les logs

2. IMPL√âMENTER L'AFFICHAGE CONDITIONNEL:
   - Cr√©er un shortcode de liste de membres
   - Filtrer par is_public = 1 pour pages publiques
   - Afficher tous si admin connect√©
   - Ajouter badge "üîí Private" pour les admins

3. V√âRIFIER LES CONSENTEMENTS:
   - Lier is_public avec consent_photography
   - Lier is_public avec parental_consent
   - Ne montrer publiquement QUE si tous consentements OK

4. MIGRATION DE DONN√âES (si n√©cessaire):
   ```sql
   -- D√©finir par d√©faut √† 0 (cach√©) si NULL
   UPDATE wp_jgk_members 
   SET is_public = 0 
   WHERE is_public IS NULL;
   ```

V√âRIFICATIONS RAPIDES:

‚úÖ Champ existe dans la table: is_public tinyint(1) DEFAULT 0
‚úÖ Champ visible dans le formulaire avec fond bleu
‚úÖ Champ envoy√© dans l'update SQL
‚úÖ Logs ajout√©s pour debugging
‚úÖ Documentation compl√®te cr√©√©e
‚úÖ Exemples de code fournis

R√âSUM√â:

Le contr√¥le de visibilit√© fonctionne maintenant correctement!
- Le champ est bien visible et compr√©hensible
- L'update inclut is_public
- Les logs permettent de debugger
- La documentation explique tout

Vous pouvez maintenant:
1. Rendre un membre VISIBLE (is_public = 1)
2. Rendre un membre CACH√â (is_public = 0)
3. Voir quelle valeur est enregistr√©e
4. Filtrer l'affichage public selon ce param√®tre

---

AIDE SUPPL√âMENTAIRE:

Si vous avez besoin d'aide pour:
- Cr√©er un shortcode filtr√© par is_public
- Modifier une page pour afficher seulement les membres publics
- Ajouter un widget de membres
- Lier is_public avec les consentements

R√©f√©rez-vous √†: VISIBILITY_CONTROL_GUIDE.md

